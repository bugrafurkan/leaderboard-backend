# PostgreSQL yüksek performans ayarları
# 10M+ kullanıcı için optimize edilmiştir

# CONNECTIONS
max_connections = 500                     # Maksimum bağlantı sayısı
superuser_reserved_connections = 5        # Yönetim işlemleri için ayrılan bağlantılar

# MEMORY SETTINGS
shared_buffers = 4GB                      # RAM'in %25'i (16GB RAM varsayımıyla)
work_mem = 16MB                           # Sorgu başına bellek
maintenance_work_mem = 512MB              # Bakım işlemleri için bellek
effective_cache_size = 12GB               # RAM'in %75'i (16GB RAM varsayımıyla)
huge_pages = try                          # Büyük sayfa bellek desteği

# WRITE AHEAD LOG (WAL)
wal_level = replica                       # Replikasyon için gerekli
max_wal_size = 4GB                        # WAL dosyalarının maksimum boyutu
min_wal_size = 1GB                        # WAL dosyalarının minimum boyutu
checkpoint_completion_target = 0.9        # Checkpoint işlemi optimizasyonu
wal_buffers = 16MB                        # WAL için bellek

# PLANNER SETTINGS
random_page_cost = 1.1                    # SSD kullanımı için optimizasyon
effective_io_concurrency = 200            # I/O paralelleştirme (SSD için)
default_statistics_target = 500           # İstatistikler için daha fazla örnek

# QUERY TUNING
jit = on                                  # Sorgu JIT derlemesi
parallel_leader_participation = on        # Paralel sorgu optimizasyonu
max_parallel_workers_per_gather = 4       # Sorgu başına paralel işçi sayısı
max_parallel_workers = 8                  # Toplam paralel işçi sayısı
max_parallel_maintenance_workers = 4      # Bakım işlemleri için paralellik

# LOGGING
log_min_duration_statement = 1000         # Yavaş sorguları loglama (1 saniye)
log_checkpoints = on                      # Checkpoint logu
log_connections = off                     # Bağlantı logu (üretimde kapalı)
log_disconnections = off                  # Bağlantı kesme logu (üretimde kapalı)
log_lock_waits = on                       # Kilit bekleme logu
log_temp_files = 0                        # Geçici dosyaları loglama
log_autovacuum_min_duration = 0           # Autovacuum logu

# AUTOVACUUM
autovacuum = on                           # Otomatik vacuum
autovacuum_max_workers = 6                # Vacuum işçi sayısı
autovacuum_naptime = 10s                  # Vacuum aralığı
autovacuum_vacuum_scale_factor = 0.05     # Tablo büyüklüğüne göre vacuum
autovacuum_analyze_scale_factor = 0.025   # Tablo büyüklüğüne göre analiz

# REPLICATION
archive_mode = on                         # WAL arşivleme
archive_command = 'cp %p /var/lib/postgresql/archive/%f'  # Arşivleme komutu
max_wal_senders = 10                      # WAL gönderici sayısı
wal_keep_segments = 64                    # Korunan WAL segment sayısı
hot_standby = on                          # Bekleme modunda okuma
max_standby_streaming_delay = 30s         # Replikasyon gecikmesi

# NETWORK
listen_addresses = '*'                    # Tüm ağ arayüzlerini dinle
